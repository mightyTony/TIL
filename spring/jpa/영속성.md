JPA 저장


비영속 -> 영속(persist) -> 


비영속 -> persist 시 영속성 컨텍스트에 객체를 저장한다 (DB에 저장 x)

영속성 컨텍스트에 객체를 저장함 


영속성 컨텍스트의 이점
  - 1차 캐시
- 동일성 보장
- 트랜잭션을 지원하는 쓰기 지연
- 변경 감지
- 지연 로딩

플러시 : 영속성 컨텍스트의 변경내용을 데이터베이스에 반영

# 플러시 발생

- 변경 감지
- 수정된 엔티티 쓰기 지연 sql  저장소에 등록
- 쓰기 지연 sql 저장소의 쿼리를 데이터베이스에 전송(등록,수정,삭제 쿼리)

영속성 컨텍스트를 플러시하는 방법
1. em.flush() - 직접호출
2. 트랜잭션 커밋 - 플러시 자동 호출
3. JPQL 쿼리 실행 - 플러시 자동 호출


준영속 상태 

- 영속 -> 준영속
- 영속 상태의 엔티티가 영속성 컨텍스트에서 분리
- 영속성 컨텍스트가 제공하는 기능을 사용 못함
- em.detach(entity) : 특정 엔티티만 준영속 상태로 전환
- em.clear() : 영속성 컨텍스트를 완전히 초기화
- em.close() : 영속성 컨텍스트를 종료
